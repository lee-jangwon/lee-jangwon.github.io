---
layout: post
title: "NGINX 이해하기"
date: 2024-01-25 19:15:00 -0000
---

옛날 옛적에 장고(Django)로 첫 블로그를 만들어서 PythonAnywhere에 배포한 적이 있었다. PythonAnywhere에서 무료로 제공하는 도메인에, 댓글 기능도 없는 블로그였지만 내가 혼자 뚝딱 거려서 만든게 인터넷에 올라가 있다는 것만으로도 신기하고 만족스러웠다. 하지만 그 당시에 내가 생각하던 웹서버는 인터넷에 연결된 컴퓨터일 뿐이었고, 단순히 장고의 `manage.py runserver` 명령어로 내 블로그를 유지 했었다. 

연결된 트위터 계정으로 글은 잘 읽었지만 블로그가 계속 다운된다는 말을 듣고도 나는 "무료로 제공하는 호스팅 서비스라 불안정 한가보다."라고 생각하고 말았다. 하지만 나름 실무를 하다보니 내 블로그가 왜 그렇게 불안정했었는지 알 수 있었다. 나는 웹 서버를 너무 쉽게 생각했던 것이다. 이 글은 과거의 죄를 용서받기 위해, 그리고 혹시라도 이 글을 읽게될 초보 장고 개발자가 나와 같은 실수를 하지 않을 수 있도록 NGINX를 소개한다.

## runsever 명령어의 용도
[장고 공식문서](https://docs.djangoproject.com/en/5.0/ref/django-admin/#runserver)를 확인해보면, 장고는 웹 프레임워크일뿐 절대 웹 서버가 아니라고 명시한다. `manage.py runserver`는 개발을 돕기위해 장고가 제공하는 최소한의 웹서버다. 여기서 구현된 서버는 한 번에 한 개의 요청만 처리할 뿐 절대 프로덕션 환경에서 사용하지 말라고 권고한다. 그럼 도대체 프로덕션 환경에서는 장고 프로젝트를 어떻게 열어줘야 될까? 여기서 필요한게 바로 웹 서버다.

# 장고 개발과 웹 서버
장고는 효율적으로 웹 앱을 만들기에 최적화되었다. 그럼에도 불구하고 장고를 만든 개발자는 장고가 해야 할 역할을 명확하게 정해놓고, 절대 웹 서버가 해야될 영역을 침범하지 않는다. 그럼 도대체 웹 서버가 해야되는 역할은 무엇일까? 장고 개발에서 웹 서버의 역할은 아래와 같이 정리할 수 있다.
1. 정적 파일 서비스
2. HTTP/HTTPS 요청 처리
3. 성능 및 보안 개선

각 역할과 NGINX가 그 역할을 어떻게 충족하는지 천천히 알아보자. 

## 정적 파일 서비스
장고는 개발 환경에서는 편하게 정적 파일을 처리해주지만 프로덕션 환경에서는 정적 파일을 더 효율적으로 처리해줄 필요가있다. NGINX는 이런 정적 파일을 최소한의 리소스로 효율적으로 제공하는데 최적화되어있다. 정적 파일을 효율적으로 제공하므로써 웹 페이지의 로딩 속도를 개선하고 내장된 캐싱 기능을 통해서 전체적인 성능을 좋게 할 수 있다.

## HTTP/HTTPS 요청 처리
브라우저에서는 HTTP와 HTTPS를 통해 사용자에게 요청을 받고, 그렇게 받은 요청에 대한 응답을 제공한다. 기본적으로 웹 브라우저는 HTTP 요청을 80번 포트로, HTTPS 요청을 403번 포트로 보낸다. 하지만 대부분의 경우 장고 앱은 8000번 포트에 호스팅된다. 이런 문제를 해결하기 위해 NGINX는 리버스 프록시의 역할을 자초해서 올바른 포트로 보내줄 수 있다.

이 리버스 프록시의 역할은 장고 또는 다른 파이썬 프로젝트에서 특히 유용하다. 브라우저는 기본적으로 파이썬을 어떻게 해야할지 모른다. 그러므로 장고나 FastAPI, Flask등 파이썬을 사용하는 프레임워크 및 라이브러리는 uWSGI/ASGI등을 통해 인터넷과 소통한다. 그렇게 될 때 인터넷을 통해 들어오는 요청을 효율적으로 처리하고 WSGI나 ASGI가 호스팅된 포트로 트래픽을 넘겨줄 수 있어야한다. 


## 성능 및 보안 개선
로드 밸런싱은 웹 서버가 기본적으로 제공하는 기능은 아니지만, 대부분의 현대 웹 서버는 로드 밸런싱 기능을 지원한다. 간단하게 로드 밸런싱을 설명하자면, 트래픽이 한 서버로 몰리게되면 성능이 안 좋아질 수 있기 때문에 여러 개의 서버를 켜놓고 요청이 들어올 때마다 어떤 서버로 들어갈지 결정해주는 작업이다. NGINX는 인터넷을 통해 들어오는 트래픽 로드를 밸런싱해주므로 앱의 성능을 개선한다.

뿐만아니라 NGINX는 SSL/TLS 암호화를 관리하므로 사용자에게 HTTPS 연결을 전달하여 더욱 안전한 웹 사용 경험을 제공해준다. 이런 모든 작업은 장고가 직접 처리해야되는 부분을 줄여주기 때문에 장고의 안정성을 개선하고 성능을 끌어올릴 수 있다.
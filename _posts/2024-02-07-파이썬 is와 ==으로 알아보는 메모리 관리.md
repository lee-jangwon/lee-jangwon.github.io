---
layout: post
title: "파이썬 is와 ==으로 알아보는 메모리 관리"
date: 2024-02-07 19:15:00 -0000
---
프로그래밍 언어로 비교하는 작업은 언어를 처음 시작할 때 가장 먼저 배우는 것중 하나이다. 파이썬에서는 is와 `==`(는는)을 통해 값의 같고 다름을 비교할 수 있지만, 이 두 방법의 차이는 무엇을 비교하느냐에 있다. 이 글은 is와 `==`이 어떻게 비교하는지 정확하게 알아보고, 이 차이점을 통해 파이썬에서 메모리가 어떻게 관리되는지도 조금 알아본다.

비교하는 작업은 너무 간단하기 때문에 예제 코드를 넣어야 될지도 고민이 되지만 글의 흐름을 위해서 조금이라도 적어본다.

## == 비교문
```python
a = "Hello"
b = "Hello"
print(a == b) # True
```
파이썬을 몇 시간만 배운 사람일지라도 위 출력문이 `True`로 평가 된다는 것을 쉽게 알 수 있다. `==` 비교는 사람이 읽을 수 있는 값을 비교한다. 위 코드에서 확인할 수 있는 것 처럼 `a`와 `b` 모두 `Hello`라는 문자열 값을 가진다. 여기서 `a == b` 비교문은 `a`의 값과 `b`의 값을 비교한다.

## is 비교문
`==`이 값을 비교한다면 과연 `is`는 무엇을 비교할까? `is` 연산자는 값이 아닌 메모리에 저장된 위치를 비교한다. 아래 코드를 참조하자.
```python
a = 1004
b = 1004
print(a is b) # False
```
만약 `is` 연산자도 `==`처럼 할당된 값을 비교한다면 `==` 단락에서 본것 처럼 `True`라는 값을 반환할 것이다. 하지만 `a is b`라는 비교문은 `False`로 평가된다. 이런 현상에 대해서 조금 더 자세하게 알아보자.

```python
print(id(a)) #140137096122576
print(id(b)) #140137096122992
```
`id` 함수는 각 객체 고유의 식별자를 반환하지만, 이 식별자란 객체가 저장된 메모리의 주소를 의미한다. 위 코드를 보면 `id(a)`와 `id(b)`가 다른 값을 출력하고, 이는 즉 `a`와 `b`가 다른 위치에 저장되었다는 의미다. 그러므로 `is` 연산자로 비교하게 된다면 `False`로 평가된다.

## 사전할당(Pre-allocated) 메모리 (Object Pooling)
여기서 내가 왜 하필 `is` 연산자를 설명할 때 1004라는 값을 사용하기로 했는지 궁금할 수도 있다. 물론 1004라는 숫자를 좋아하기도 하지만, 굳이 1004로 설명한 이유는 바로 사전할당 메모리를 설명하기 위해서다.

파이썬은 C로 작성된 CPython이 기본이다. 물론 자바로 작성된 Jython도 있지만, 파이썬 메인 페이지에서 내려받는 파이썬은 C로 작성됐다. 이렇게 C로 작성된 파이썬은 C와 비슷하게 미리 자주 쓰이는 값을 할당해둔다.

```python
a = 0
b = 0
while a is b:
    a += 1
    b += 1
print(f"파이썬은 0부터 {a - 1}까지 메모리를 미리 할당합니다.") # 256
```

상수(Integer)만 비교해 봤을 때는 -5에서 256까지 미리 메모리를 할당해 놓는다. 다른 말로, -5에서 256까지는 `==`과 `is`로 비교해도 `True`로 판정된다는 것이다.

## 메모리 할당
파이썬은 변수를 생성할 떄 동적으로 메모리를 할당하기 때문에 일반적인 개발 업무에서는 메모리가 어떻게 사용되는지 신경 쓸 필요가 없다. 하지만 다루는 데이터가 커지거나 트래픽이 많을 경우, 코드 한줄 한줄 성능 최적화가 불가피할 수도 있다.

파이썬이 기본적으로 제공하는 가비지 콜렉션(Garbage Collection)은 초기 개발을 편하게 할수는 있지만, 성능이 중요한 문제를 다룰 때 양날의 검으로 돌아올 수 있다. 이런 문제를 피하기 위해서는 언어 내부구현이 어떻게 작성되었는지 자세하게 알아야 하지만, 내부구현을 모두 꼼꼼하게 보지 않더라도 성능 문제를 피할 수 있는 팁을 제시한다.

1. 전역 변수(Global Variable) 사용을 최소화한다.
2. 용량이 큰 변수로 작업을 할 때는 제네레이터 또는 이터레이터를 사용한다.
3. 객체를 참조할 떄는 꼭 다시 한 번 생각해본다.
4. 필요 없는 객체는 반드시 명시적으로 삭제를 하거나 `with` 컨텍스트 관리자(Context Manager)를 사용한다.
